<!DOCTYPE html>
<html>

<head>
    <title>Carrom</title>
    <meta charset="UTF-8">
    <meta name="theme-color" content="#ADD8E6">
    <link rel="manifest" href="manifest.json">
    <style>div.hole{background-color:#000;position:absolute}div.strickerLine{border:1px solid #000;position:absolute;text-align:center;vertical-align:middle;font-size:4vmin}</style>
</head>

<body>
    <div id="border" style="background-color:#ADD8E6;position:relative" onsize="sizeCarrom()"><input type="button"
            style="position:absolute;font-size:10vmin" onclick="restart()" value="&#x27f3;">
        <div id="carromOuter" style="position:absolute;background-color:#000">
            <div id="carromInner" style="position:absolute;background-color:#fafad2">
                <div class="hole"></div>
                <div class="hole"></div>
                <div class="hole"></div>
                <div class="hole"></div>
                <div class="strickerLine" onclick="placeStricker(event,1)" id="player1"></div>
                <div class="strickerLine"></div>
                <div class="strickerLine" onclick="placeStricker(event,0)" id="player0"></div>
                <div class="strickerLine"></div>
                <div id="center" style="position:absolute;background-color:pink"></div>
                <div id="shooter" style="position:absolute;background-color:grey;border:1px solid #000;opacity:.5;z-index:1"
                    onclick="strick(event)"></div>
            </div>
        </div>
    </div>
    <script>function restart() { initialise(), sizeCarrom(), updateScores() } function initialise() { for (var e = 0; e < g_arrCoins.length; e++) { var r = g_arrCoins[e]; null != r.elementRef && (document.getElementById("carromInner").removeChild(r.elementRef), r.elementRef = null) } g_arrCoins = null, g_arrCoins = [{ mass: 5, radiusFactor: .04, position: { x: 0, y: 0 }, velocity: { x: 0, y: 0 }, elementRef: null }, { mass: 2, radiusFactor: .03, position: { x: 0, y: 0 }, velocity: { x: 0, y: 0 }, elementRef: null }], void 0 != g_timerId && clearInterval(g_timerId), g_timerId = void 0, g_scores[0] = g_scores[1] = 0, g_currPlayer = void 0 } function sizeCarrom() { var e = document.getElementsByTagName("body")[0], r = document.getElementById("border"), t = window.innerWidth - parseInt(getComputedStyle(e).marginLeft) - parseInt(getComputedStyle(e).marginRight), i = window.innerHeight - parseInt(getComputedStyle(e).marginTop) - parseInt(getComputedStyle(e).marginBottom); r.style.width = t + "px", r.style.height = i + "px", g_carromSize = t < i ? t : i, g_carromInnerSize = g_carromSize * g_carromBorderFactor; var o = document.getElementById("carromOuter"); o.style.width = o.style.height = g_carromSize + "px", o.style.left = (t - g_carromSize) / 2 + "px", o.style.top = (i - g_carromSize) / 2 + "px", o.style.borderRadius = g_carromSize * g_carromCornerRadiusFactor + "px"; var n = document.getElementById("carromInner"); n.style.width = n.style.height = g_carromInnerSize + "px", n.style.left = n.style.top = (g_carromSize - g_carromInnerSize) / 2 + "px", n.style.borderRadius = g_carromSize * g_carromHoleRadiusFactor + "px"; for (var s = document.getElementsByClassName("hole"), a = g_carromSize * g_carromHoleRadiusFactor, l = 0; l < s.length; l++)g_holeCenters.push({ x: 1 == l || 2 == l ? g_carromInnerSize - a : a, y: 2 == l || 3 == l ? g_carromInnerSize - a : a }), s[l].style.left = g_holeCenters[l].x - a + "px", s[l].style.top = g_holeCenters[l].y - a + "px", s[l].style.width = s[l].style.height = 2 * a + "px", s[l].style.borderRadius = a + "px"; for (var g = document.getElementsByClassName("strickerLine"), c = g_carromSize * g_carromStrickerOffsetFactor, y = 2 * g_carromSize * g_arrCoins[0].radiusFactor, m = [{ x: c + y, y: c }, { x: g_carromInnerSize - c - y, y: c + y }, { x: c + y, y: g_carromInnerSize - c - y }, { x: c, y: c + y }], l = 0; l < g.length; l++)g[l].style.left = m[l].x + "px", g[l].style.top = m[l].y + "px", g[l].style.width = (0 == l || 2 == l ? g_carromInnerSize - 2 * (c + y) : y) + "px", g[l].style.height = (1 == l || 3 == l ? g_carromInnerSize - 2 * (c + y) : y) + "px", g[l].style.borderRadius = y / 2 + "px"; var _ = document.getElementById("center"), d = 2 * g_carromSize * g_arrCoins[1].radiusFactor; _.style.width = _.style.height = d + "px", _.style.left = _.style.top = (g_carromInnerSize - d) / 2 + "px", _.style.borderRadius = d / 2 + "px"; var p = document.createElement("div"); n.appendChild(p), g_arrCoins[0].elementRef = p; var x = g_carromSize * g_arrCoins[0].radiusFactor; p.style.backgroundColor = "blue", p.style.position = "absolute", p.style.border = "1px solid black", p.style.width = p.style.height = 2 * x + "px", p.style.borderRadius = x + "px", g_strickerMinX = m[2].x + x, g_strickerMaxX = g_strickerMinX + g_carromInnerSize - 2 * (c + y) - x, g_strickerY[0] = m[2].y + x, g_strickerY[1] = m[0].y + x, g_arrCoins[0].position.x = g_strickerMinX + g_strickerMaxX / 2, g_arrCoins[0].position.y = g_strickerY[0]; for (var l = 1; l <= 5; l++) { var u = document.createElement("div"); n.appendChild(u), 1 != l && g_arrCoins.push({ mass: g_arrCoins[1].mass, radiusFactor: g_arrCoins[1].radiusFactor, position: { x: 0, y: 0 }, velocity: { x: 0, y: 0 }, elementRef: null }); var f = g_carromSize * g_arrCoins[l].radiusFactor; u.style.backgroundColor = "green", u.style.position = "absolute", u.style.border = "1px solid black", u.style.width = u.style.height = 2 * f + "px"; do g_arrCoins[l].position.x = f + Math.random() * (g_carromInnerSize - 2 * f), g_arrCoins[l].position.y = f + Math.random() * (g_carromInnerSize - 2 * f); while (1 == isInterfering(g_arrCoins[l])); u.style.left = g_arrCoins[l].position.x - f + "px", u.style.top = g_arrCoins[l].position.y - f + "px", u.style.borderRadius = f + "px", g_arrCoins[l].elementRef = u } placeStricker(null, 0) } function isInterfering(e) { for (var r = 0; r < g_arrCoins.length; r++)if (e.elementRef != g_arrCoins[r].elementRef) { var t = g_arrCoins[r], i = e.position.x - t.position.x, o = e.position.y - t.position.y, n = Math.sqrt(i * i + o * o), s = g_carromSize * (t.radiusFactor + e.radiusFactor); if (n <= s) return !0 } return !1 } function findProjection(e, r, t, i) { var o = e * t + r * i; return { x: o * t, y: o * i } } function strick(e) { if (void 0 == g_timerId) { var r = document.getElementById("shooter"); r.style.visibility = "hidden"; var t = g_shooterSizeFactorFrmStricker * g_carromSize * g_arrCoins[0].radiusFactor, i = parseInt(e.offsetX) - t, o = parseInt(e.offsetY) - (parseInt(r.style.borderTopLeftRadius) > 0 ? t : 0), n = .35 * g_carromInnerSize / t; g_arrCoins[0].velocity.x = i * n, g_arrCoins[0].velocity.y = o * n, g_deceleration = .025 * g_carromInnerSize, g_timerId = setInterval(function () { for (var e = !1, r = g_carromSize * g_carromHoleRadiusFactor, t = 0; t < g_arrCoins.length; t++) { var i = g_arrCoins[t]; if (null != i.elementRef) { for (var o = 0; o < g_holeCenters.length; o++) { var n = Math.pow(i.position.x - g_holeCenters[o].x, 2) + Math.pow(i.position.y - g_holeCenters[o].y, 2); if (n < r * r) { document.getElementById("carromInner").removeChild(i.elementRef), i.elementRef = null, g_scores[g_currPlayer] += 0 == t ? -g_arrCoins.length : 1; break } } if (null != i.elementRef) { for (var o = (new Array, 0); o < g_arrCoins.length; o++) { var s = g_arrCoins[o]; if (t != o && null != s.elementRef) { var a = s.position.x - i.position.x, l = s.position.y - i.position.y, g = Math.sqrt(a * a + l * l), c = g_carromSize * (i.radiusFactor + s.radiusFactor); if (g <= c) { a /= g, l /= g; var y = findProjection(i.velocity.x, i.velocity.y, a, l), m = findProjection(s.velocity.x, s.velocity.y, a, l), _ = i.mass * y.x + s.mass * m.x, d = i.mass * y.y + s.mass * m.y, p = i.mass + s.mass, x = m.x - y.x, u = m.y - y.y, f = findProjection(i.velocity.x, i.velocity.y, -l, a), v = findProjection(s.velocity.x, s.velocity.y, -l, a); i.velocity.x = (s.mass * x + _) / p + f.x, i.velocity.y = (s.mass * u + d) / p + f.y, s.velocity.x = (i.mass * -x + _) / p + v.x, s.velocity.y = (i.mass * -u + d) / p + v.y, s.mass <= i.mass ? (s.position.x = i.position.x + a * c, s.position.y = i.position.y + l * c) : (i.position.x = s.position.x - a * c, i.position.y = s.position.y - l * c) } } } var C = Math.sqrt(i.velocity.x * i.velocity.x + i.velocity.y * i.velocity.y), h = C - g_deceleration * g_timeIncr; if (h = h <= .001 ? 0 : h, 0 != h) { e = !0, i.velocity.x *= h / C, i.velocity.y *= h / C, i.position.x += i.velocity.x * g_timeIncr, i.position.y += i.velocity.y * g_timeIncr; var S = g_carromSize * i.radiusFactor; i.position.x <= S && (i.velocity.x *= -1, i.position.x = S), i.position.x >= g_carromInnerSize - S && (i.velocity.x *= -1, i.position.x = g_carromInnerSize - S), i.position.y <= S && (i.velocity.y *= -1, i.position.y = S), i.position.y >= g_carromInnerSize - S && (i.velocity.y *= -1, i.position.y = g_carromInnerSize - S), i.elementRef.style.left = i.position.x - S + "px", i.elementRef.style.top = i.position.y - S + "px" } } } } 0 == e && (clearInterval(g_timerId), g_timerId = void 0), updateScores() }, g_timer) } } function placeStricker(e, r) { if (void 0 == g_timerId && null != g_arrCoins[0].elementRef) { var t = g_arrCoins[0].position.x, i = g_arrCoins[0].position.y; if (null != e) { var o = e.offsetX + parseInt(e.target.style.left); o < g_strickerMinX && (o = g_strickerMinX), o > g_strickerMaxX && (o = g_strickerMaxX), g_arrCoins[0].position.x = o } if (g_arrCoins[0].position.y = g_strickerY[r], 1 == isInterfering(g_arrCoins[0])) return g_arrCoins[0].position.x = t, void (g_arrCoins[0].position.y = i); g_currPlayer = r; var n = g_carromSize * g_arrCoins[0].radiusFactor; g_arrCoins[0].elementRef.style.left = g_arrCoins[0].position.x - n + "px", g_arrCoins[0].elementRef.style.top = g_arrCoins[0].position.y - n + "px"; var s = document.getElementById("shooter"); s.style.visibility = "visible"; var a = g_shooterSizeFactorFrmStricker * n; s.style.width = 2 * a + "px", s.style.height = a + "px", s.style.left = g_arrCoins[0].position.x - a + "px", s.style.borderRadius = "0px", 0 == r ? (s.style.top = g_arrCoins[0].position.y - a + "px", s.style.borderTopLeftRadius = a + "px", s.style.borderTopRightRadius = a + "px") : 1 == r && (s.style.top = g_arrCoins[0].position.y + "px", s.style.borderBottomLeftRadius = a + "px", s.style.borderBottomRightRadius = a + "px") } } function updateScores() { document.getElementById("player0").innerHTML = "Score : " + g_scores[0], document.getElementById("player1").innerHTML = "Score : " + g_scores[1] } var g_carromSize = 0, g_carromInnerSize = 0, g_carromBorderFactor = .95, g_carromCornerRadiusFactor = .01, g_carromHoleRadiusFactor = .0425, g_carromStrickerOffsetFactor = .08, g_shooterSizeFactorFrmStricker = 8, g_arrCoins = [], g_deceleration = 0, g_timeIncr = .01, g_timer = 1, g_strickerY = [0, 0], g_strickerMinX = 0, g_strickerMaxX = 0, g_holeCenters = new Array, g_timerId = void 0, g_scores = [0, 0], g_currPlayer = void 0; (function () { initialise(), sizeCarrom(), updateScores() })()</script>
</body>

</html>
